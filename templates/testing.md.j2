# ACI Fabric Test Plan (Starter)

This section lists practical tests to validate key features discovered from the fabric.

{% for t in data.tenants %}
## Tenant: {{ t.name }}

### 1) EPG ↔ BD ↔ VRF reachability
- Verify each EPG's BD default gateway is reachable from at least one endpoint.
{% for e in (t.epgs or [])[:10] %}
  - **EPG:** {{ e.name }} (AP: {{ e.ap }}) — Ping BD gateway of its BD(s). _Note: map EPG→BD via contract or AP policy._
{% endfor %}

### 2) Contracts / Filters
- For each contract, verify intended flows:
{% for c in t.contracts or [] %}
  - **Contract:** {{ c.name }} — run TCP/UDP tests for each subject (e.g., `iperf`, `curl`, `nc`). Ensure deny logs where expected.
{% endfor %}

### 3) L3Outs
{% for l in t.l3outs or [] %}
- **L3Out {{ l.name }} (VRF {{ l.vrf }})** — Validate:
  - OSPF/BGP session up: {{ l.protocols|join(', ') if l.protocols else 'N/A' }}
  - Received/advertised routes include: {{ l.external_subnets|length }} external subnet(s)
  - Ping upstream next-hop and public test IP (if allowed).
{% endfor %}

### 4) L2Outs
{% for l2 in t.l2outs or [] %}
- **L2Out {{ l2.name }}** — Validate:
  - Bridge-domain mapping: BD **{{ l2.bd }}**
  - VLAN/handoff as per domain(s): {{ l2.domains|join(', ') }}
  - MAC learning and ARP resolution across the handoff.
{% endfor %}

### 5) Service Graphs
{% for g in t.service_graphs or [] %}
- **Graph {{ g.name }}** — Validate traffic redirection across nodes:
  - Nodes: {% for n in g.nodes %}{{ n.name }} ({{ n.funcType|default('func') }}){% if not loop.last %}, {% endif %}{% endfor %}
  - If redirect policies: {{ g.redirect_policies|map(attribute='name')|list|join(', ') or 'None' }}
  - Run bidirectional tests (client↔server) and ensure policy hits/logs on device.
{% endfor %}

---

{% endfor %}

## Generic command snippets

- **Endpoint to gateway ping**: `ping -c 5 <BD_GW>`
- **TCP test**: `nc -zv <dst> <port>` or `curl -I http://<dst>:<port>`
- **Throughput test**: `iperf3 -c <dst> -p <port>`
- **Route view (upstream)**: `show ip route <prefix>` on upstream
